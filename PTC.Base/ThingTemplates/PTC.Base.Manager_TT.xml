<?xml version="1.0" encoding="UTF-8"?>
<Entities
 majorVersion="9"
 minorVersion="3"
 universal="password">
    <ThingTemplates>
        <ThingTemplate
         aspect.isEditableExtensionObject="false"
         aspect.isExtension="true"
         baseThingTemplate="PTC.Base.CommonManager_TT"
         description="Base Component Manager Template. Combines the functions of the Common Manager template and the Base Management TS functions"
         documentationContent=""
         effectiveThingPackage="ConfiguredThing"
         homeMashup=""
         inheritedValueStream=""
         name="PTC.Base.Manager_TT"
         projectName="PTC.Base"
         tags=""
         thingPackage=""
         valueStream="">
            <avatar></avatar>
            <DesignTimePermissions>
                <Create></Create>
                <Read></Read>
                <Update></Update>
                <Delete></Delete>
                <Metadata></Metadata>
            </DesignTimePermissions>
            <RunTimePermissions></RunTimePermissions>
            <VisibilityPermissions>
                <Visibility>
                    <Principal
                     isPermitted="true"
                     name="PTC.Base.Default_OR:PTC.Base.Default_UG"
                     type="OrganizationalUnit"></Principal>
                </Visibility>
            </VisibilityPermissions>
            <ConfigurationTableDefinitions></ConfigurationTableDefinitions>
            <ConfigurationTables>
                <ConfigurationTable
                 dataShapeName=""
                 description="Contains a list of configured default managers to use for each building block."
                 isMultiRow="true"
                 name="DefaultGlobalManagerConfiguration"
                 ordinal="0">
                    <DataShape>
                        <FieldDefinitions>
                            <FieldDefinition
                             aspect.isPrimaryKey="true"
                             baseType="STRING"
                             description="unique identifier for the manager that needs to be configured"
                             name="id"
                             ordinal="1"></FieldDefinition>
                            <FieldDefinition
                             aspect.isPrimaryKey="false"
                             aspect.thingShape="PTC.Base.CommonManagement_TS"
                             baseType="THINGNAME"
                             description="Name of the Manager Thing to be configured"
                             name="managerThingName"
                             ordinal="2"></FieldDefinition>
                        </FieldDefinitions>
                    </DataShape>
                    <Rows></Rows>
                </ConfigurationTable>
                <ConfigurationTable
                 dataShapeName=""
                 description="Configuration table that is used to hold the configured solution name for the suite of installed building blocks."
                 isMultiRow="false"
                 name="DefaultSolutionNameConfiguration"
                 ordinal="0">
                    <DataShape>
                        <FieldDefinitions>
                            <FieldDefinition
                             aspect.isPrimaryKey="true"
                             baseType="STRING"
                             description="String representation of the name of the solution to use with this environment"
                             name="solutionName"
                             ordinal="1"></FieldDefinition>
                        </FieldDefinitions>
                    </DataShape>
                    <Rows>
                        <Row>
                            <solutionName></solutionName>
                        </Row>
                    </Rows>
                </ConfigurationTable>
                <ConfigurationTable
                 dataShapeName=""
                 description="Configuration table used to identify managers that the building block should use"
                 isMultiRow="true"
                 name="ManagerConfiguration"
                 ordinal="0">
                    <DataShape>
                        <FieldDefinitions>
                            <FieldDefinition
                             aspect.isPrimaryKey="true"
                             baseType="STRING"
                             description="unique identifier for the manager that needs to be configured"
                             name="id"
                             ordinal="1"></FieldDefinition>
                            <FieldDefinition
                             aspect.isPrimaryKey="false"
                             aspect.thingShape="PTC.Base.CommonManagement_TS"
                             baseType="THINGNAME"
                             description="Name of the Manager Thing to be configured"
                             name="managerThingName"
                             ordinal="2"></FieldDefinition>
                        </FieldDefinitions>
                    </DataShape>
                    <Rows></Rows>
                </ConfigurationTable>
                <ConfigurationTable
                 dataShapeName=""
                 description=""
                 isMultiRow="true"
                 name="MashupConfiguration"
                 ordinal="0">
                    <DataShape>
                        <FieldDefinitions>
                            <FieldDefinition
                             aspect.isPrimaryKey="true"
                             baseType="STRING"
                             description="unique identifier used to identify the thing or mashup that is being configured"
                             name="id"
                             ordinal="1"></FieldDefinition>
                            <FieldDefinition
                             aspect.isPrimaryKey="false"
                             baseType="MASHUPNAME"
                             description="name of the mashup to configure"
                             name="mashupName"
                             ordinal="2"></FieldDefinition>
                        </FieldDefinitions>
                    </DataShape>
                    <Rows></Rows>
                </ConfigurationTable>
                <ConfigurationTable
                 dataShapeName=""
                 description="Configuration table for dynamic menus. Menu Items can be specified here and they will show up for the given menu name. "
                 isMultiRow="true"
                 name="MenuConfiguration"
                 ordinal="0">
                    <DataShape>
                        <FieldDefinitions>
                            <FieldDefinition
                             aspect.isPrimaryKey="false"
                             baseType="STRING"
                             description=""
                             name="menuItemMashupName"
                             ordinal="2"></FieldDefinition>
                            <FieldDefinition
                             aspect.isPrimaryKey="true"
                             baseType="STRING"
                             description=""
                             name="menuName"
                             ordinal="3"></FieldDefinition>
                            <FieldDefinition
                             aspect.isPrimaryKey="false"
                             baseType="INTEGER"
                             description="An optional field to indicate the ordering of the menu items"
                             name="menuOrderPreference"
                             ordinal="5"></FieldDefinition>
                            <FieldDefinition
                             aspect.isPrimaryKey="false"
                             baseType="STRING"
                             description="Localization table key for the optional section that groups like menus together"
                             name="menuSectionKey"
                             ordinal="4"></FieldDefinition>
                            <FieldDefinition
                             aspect.isPrimaryKey="false"
                             baseType="STRING"
                             description="Localization table key for the menu label"
                             name="menuTitleKey"
                             ordinal="1"></FieldDefinition>
                            <FieldDefinition
                             aspect.dataShape="PTC.Base.ComponentMenuConfiguration"
                             aspect.isPrimaryKey="false"
                             baseType="INFOTABLE"
                             description=""
                             name="submenu"
                             ordinal="6"></FieldDefinition>
                        </FieldDefinitions>
                    </DataShape>
                    <Rows></Rows>
                </ConfigurationTable>
                <ConfigurationTable
                 dataShapeName=""
                 description="Configuration table for any Things that need to be configured. This allows for OOTB things to be customized, and the new version that should be used can be configured here"
                 isMultiRow="true"
                 name="ThingConfiguration"
                 ordinal="0">
                    <DataShape>
                        <FieldDefinitions>
                            <FieldDefinition
                             aspect.isPrimaryKey="true"
                             baseType="STRING"
                             description="unique identifier used to identify the thing or mashup that is being configured"
                             name="id"
                             ordinal="1"></FieldDefinition>
                            <FieldDefinition
                             aspect.isPrimaryKey="false"
                             baseType="THINGNAME"
                             description="Name of the Thing entity or Mashup entity that is to be configured"
                             name="thingName"
                             ordinal="2"></FieldDefinition>
                        </FieldDefinitions>
                    </DataShape>
                    <Rows></Rows>
                </ConfigurationTable>
            </ConfigurationTables>
            <PropertyBindings></PropertyBindings>
            <RemotePropertyBindings></RemotePropertyBindings>
            <RemoteServiceBindings></RemoteServiceBindings>
            <RemoteEventBindings></RemoteEventBindings>
            <AlertConfigurations></AlertConfigurations>
            <ThingShape>
                <PropertyDefinitions></PropertyDefinitions>
                <ServiceDefinitions></ServiceDefinitions>
                <EventDefinitions></EventDefinitions>
                <ServiceMappings></ServiceMappings>
                <ServiceImplementations>
                    <ServiceImplementation
                     description=""
                     handlerName="Script"
                     name="GetAllOrderedConfiguredManagers">
                        <ConfigurationTables>
                            <ConfigurationTable
                             dataShapeName=""
                             description=""
                             isMultiRow="false"
                             name="Script"
                             ordinal="0">
                                <DataShape>
                                    <FieldDefinitions>
                                        <FieldDefinition
                                         baseType="STRING"
                                         description="code"
                                         name="code"
                                         ordinal="0"></FieldDefinition>
                                    </FieldDefinitions>
                                </DataShape>
                                <Rows>
                                    <Row>
                                        <code>
                                        <![CDATA[
                                        let componentDeployOrder = me.GetComponentDeploymentOrder();
                                        let managerInfoTable = me.GetAllConfiguredManagers();
                                        let managerCacheByProject = {};
                                        for (var i = 0; i < managerInfoTable.length; i++) {
                                        	var managerThingName = managerInfoTable.rows[i].managerThingName;
                                        	var id = managerInfoTable.rows[i].id;
                                        	var manager = Things[managerThingName];
                                        	let projectName = manager.GetProjectName();
                                        	let managers = managerCacheByProject[projectName];
                                        	if (!managers) {
                                        		managers = [];
                                        	}
                                        	managers.push({
                                        		id: id,
                                        		managerThingName: managerThingName
                                        	});
                                        	managerCacheByProject[projectName] = managers;
                                        }
                                        var result = DataShapes["PTC.Base.ManagerConfiguration"].CreateValues();
                                        componentDeployOrder.array.forEach(item => {
                                        	let managers = managerCacheByProject[item];
                                        	if (managers) {
                                        		managers.forEach(manager => {
                                        			let row = {};
                                                    row.id = manager.id;
                                                    row.managerThingName = manager.managerThingName;
                                        			result.AddRow(row);
                                        		});
                                        	}
                                        });
                                        ]]>
                                        </code>
                                    </Row>
                                </Rows>
                            </ConfigurationTable>
                        </ConfigurationTables>
                    </ServiceImplementation>
                </ServiceImplementations>
                <Subscriptions></Subscriptions>
            </ThingShape>
            <ImplementedShapes>
                <ImplementedShape
                 name="PTC.Base.GlobalConfiguration_TS"
                 type="ThingShape"></ImplementedShape>
                <ImplementedShape
                 name="PTC.Base.Management_TS"
                 type="ThingShape"></ImplementedShape>
            </ImplementedShapes>
            <SharedConfigurationTables></SharedConfigurationTables>
            <InstanceDesignTimePermissions>
                <Create></Create>
                <Read></Read>
                <Update></Update>
                <Delete></Delete>
                <Metadata></Metadata>
            </InstanceDesignTimePermissions>
            <InstanceRunTimePermissions></InstanceRunTimePermissions>
            <InstanceVisibilityPermissions>
                <Visibility></Visibility>
            </InstanceVisibilityPermissions>
        </ThingTemplate>
    </ThingTemplates>
</Entities>
